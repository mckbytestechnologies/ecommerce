<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Blog Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-draft {
            background: #ffeb3b;
            color: #333;
        }
        
        .status-published {
            background: #4CAF50;
            color: white;
        }
        
        .status-archived {
            background: #9e9e9e;
            color: white;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .section-title {
            color: #555;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: none;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .hidden {
            display: none;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .config-section {
            background: #e8f4fd;
            border: 1px solid #b6d4fe;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .config-section h3 {
            margin-bottom: 10px;
            color: #0d6efd;
        }
        
        .endpoint-test {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        .endpoint-test h3 {
            margin-bottom: 10px;
            color: #666;
        }
        
        .endpoint-list {
            list-style: none;
            padding: 0;
        }
        
        .endpoint-list li {
            padding: 5px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .endpoint-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù Simple Blog Manager</h1>
        
        <!-- Debug Configuration -->
        <div class="config-section">
            <h3>üîß API Configuration</h3>
            <p>Current API Base URL: <span id="apiBase"></span></p>
            <p>Token Status: <span id="tokenStatus"></span></p>
            <div style="margin-top: 10px;">
                <button class="btn btn-secondary" onclick="testEndpoints()">Test Endpoints</button>
                <button class="btn" onclick="showDebugInfo()">Show Debug Info</button>
                <button class="btn btn-warning" onclick="setCustomEndpoint()">Set Custom Endpoint</button>
            </div>
        </div>
        
        <!-- Debug Info -->
        <div id="debugInfo" class="debug-info hidden"></div>
        
        <!-- Messages -->
        <div id="message" class="message"></div>
        
        <!-- Main Controls -->
        <div class="section">
            <div class="section-title">Blog Management</div>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="showCreateForm()">‚ûï Create New Blog</button>
                <button class="btn btn-secondary" onclick="loadBlogs()">üîÑ Refresh List</button>
                <button class="btn btn-warning" onclick="showStats()">üìä View Stats</button>
            </div>
            
            <!-- Filters -->
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label>Status:</label>
                    <select id="statusFilter" onchange="loadBlogs()">
                        <option value="all">All Status</option>
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="archived">Archived</option>
                    </select>
                </div>
                <div>
                    <label>Category:</label>
                    <select id="categoryFilter" onchange="loadBlogs()">
                        <option value="all">All Categories</option>
                        <option value="Technology">Technology</option>
                        <option value="Fashion">Fashion</option>
                        <option value="Lifestyle">Lifestyle</option>
                        <option value="Health">Health</option>
                        <option value="Business">Business</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <!-- Blog List -->
            <div id="blogList">
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Views</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="blogTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <p>No blogs loaded yet. Click "Refresh List" to load blogs.</p>
                                <p><small>If you see an error, check the API Configuration section above.</small></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="pagination" style="margin-top: 20px; text-align: center;"></div>
            </div>
            
            <!-- Endpoint Test -->
            <div class="endpoint-test">
                <h3>üì° API Endpoints</h3>
                <ul class="endpoint-list" id="endpointList">
                    <!-- Will be populated by JavaScript -->
                </ul>
            </div>
        </div>
        
        <!-- Create/Edit Form (Modal) -->
        <div id="blogModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">Create New Blog</div>
                    <button class="close-modal" onclick="closeModal()">√ó</button>
                </div>
                
                <form id="blogForm" onsubmit="saveBlog(event)">
                    <input type="hidden" id="blogId">
                    
                    <div class="form-group">
                        <label for="title">Title *</label>
                        <input type="text" id="title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="excerpt">Excerpt *</label>
                        <textarea id="excerpt" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="content">Content (HTML) *</label>
                        <textarea id="content" required placeholder="Enter HTML content..."></textarea>
                        <small>Use HTML tags for formatting (e.g., &lt;p&gt;, &lt;h1&gt;, &lt;img&gt;)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="featuredImage">Featured Image URL *</label>
                        <input type="text" id="featuredImage" required 
                               placeholder="https://example.com/image.jpg">
                        <img id="imagePreview" class="image-preview" alt="Preview">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="category">Category *</label>
                            <select id="category" required>
                                <option value="">Select Category</option>
                                <option value="Technology">Technology</option>
                                <option value="Fashion">Fashion</option>
                                <option value="Lifestyle">Lifestyle</option>
                                <option value="Health">Health</option>
                                <option value="Business">Business</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="tags">Tags (comma separated)</label>
                            <input type="text" id="tags" placeholder="tech, web, design">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="readTime">Read Time (minutes)</label>
                            <input type="number" id="readTime" value="5" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="sliderOrder">Slider Order</label>
                            <input type="number" id="sliderOrder" value="0" min="0">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="checkbox-group">
                            <input type="checkbox" id="featuredInSlider">
                            <label for="featuredInSlider">Featured in Slider</label>
                        </div>
                        
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select id="status">
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                                <option value="archived">Archived</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ Save Blog</button>
                        <button type="button" class="btn" onclick="saveAsDraft()">üìù Save as Draft</button>
                        <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Configuration - CHANGE THESE FOR YOUR SETUP
        let API_BASE = '/api/blogs';  // Public endpoints
        let ADMIN_API_BASE = '/api/blogs/admin';  // Admin endpoints - ADJUST THIS!
        let token = localStorage.getItem('adminToken');
        
        // Debug variables
        let debugMode = true;
        let currentPage = 1;
        let totalPages = 1;
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateConfigDisplay();
            
            // Try to get token from URL if not in localStorage
            if (!token) {
                const urlParams = new URLSearchParams(window.location.search);
                token = urlParams.get('token');
                if (token) {
                    localStorage.setItem('adminToken', token);
                    updateConfigDisplay();
                }
            }
            
            // If still no token, show instructions
            if (!token) {
                showMessage('No authentication token found. Please login first.', 'error');
                document.getElementById('blogList').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>Authentication Required</h3>
                        <p>You need to login to access the blog manager.</p>
                        <p><strong>Options:</strong></p>
                        <ol style="text-align: left; display: inline-block; margin: 20px;">
                            <li>Go to your login page and copy the JWT token</li>
                            <li>Visit this page with ?token=YOUR_TOKEN in the URL</li>
                            <li>The token will be saved automatically</li>
                        </ol>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="simulateLogin()">Simulate Login (for testing)</button>
                        </div>
                    </div>
                `;
            } else {
                // Try to load blogs
                loadBlogs();
            }
            
            // Populate endpoint list
            populateEndpointList();
        });
        
        // Update configuration display
        function updateConfigDisplay() {
            document.getElementById('apiBase').textContent = ADMIN_API_BASE;
            document.getElementById('tokenStatus').textContent = token ? 
                '‚úÖ Token found (' + token.substring(0, 20) + '...)' : 
                '‚ùå No token';
        }
        
        // Populate endpoint list
        function populateEndpointList() {
            const endpoints = [
                { method: 'GET', path: '/api/blogs', desc: 'Get all blogs (public)' },
                { method: 'GET', path: '/api/blogs/:slug', desc: 'Get single blog by slug' },
                { method: 'GET', path: '/api/blogs/admin/blogs', desc: 'Get blogs (admin)' },
                { method: 'POST', path: '/api/blogs/admin/blogs', desc: 'Create blog' },
                { method: 'PUT', path: '/api/blogs/admin/blogs/:id', desc: 'Update blog' },
                { method: 'DELETE', path: '/api/blogs/admin/blogs/:id', desc: 'Delete blog' }
            ];
            
            const list = document.getElementById('endpointList');
            list.innerHTML = endpoints.map(ep => `
                <li>
                    <strong>${ep.method}</strong> ${ep.path}<br>
                    <small>${ep.desc}</small>
                </li>
            `).join('');
        }
        
        // Show debug info
        function showDebugInfo() {
            const info = `
Current Configuration:
- API Base: ${API_BASE}
- Admin API Base: ${ADMIN_API_BASE}
- Token: ${token ? 'Present (' + token.substring(0, 30) + '...)' : 'Missing'}
- Current Page: ${currentPage}
- Debug Mode: ${debugMode}

Browser Info:
- URL: ${window.location.href}
- Origin: ${window.location.origin}
- Path: ${window.location.pathname}

LocalStorage:
- adminToken: ${localStorage.getItem('adminToken') ? 'Present' : 'Missing'}
            `;
            
            document.getElementById('debugInfo').textContent = info;
            document.getElementById('debugInfo').classList.toggle('hidden');
        }
        
        // Set custom endpoint
        function setCustomEndpoint() {
            const newBase = prompt('Enter new Admin API base URL:', ADMIN_API_BASE);
            if (newBase) {
                ADMIN_API_BASE = newBase;
                updateConfigDisplay();
                showMessage(`API base updated to: ${ADMIN_API_BASE}`, 'info');
                loadBlogs(); // Try with new endpoint
            }
        }
        
        // Test endpoints
        async function testEndpoints() {
            showMessage('Testing endpoints...', 'info');
            
            const tests = [
                { name: 'Public Blogs', url: `${window.location.origin}${API_BASE}`, method: 'GET' },
                { name: 'Admin Blogs', url: `${window.location.origin}${ADMIN_API_BASE}/blogs`, method: 'GET' }
            ];
            
            const results = [];
            
            for (const test of tests) {
                try {
                    const start = Date.now();
                    const response = await fetch(test.url, {
                        method: test.method,
                        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                    });
                    const elapsed = Date.now() - start;
                    
                    const contentType = response.headers.get('content-type');
                    const isJson = contentType && contentType.includes('application/json');
                    
                    let result;
                    if (isJson) {
                        result = await response.json();
                    } else {
                        result = await response.text();
                    }
                    
                    results.push({
                        name: test.name,
                        url: test.url,
                        status: response.status,
                        ok: response.ok,
                        contentType: contentType,
                        isJson: isJson,
                        elapsed: elapsed,
                        data: isJson ? 'JSON response' : 'Non-JSON response (likely HTML)'
                    });
                } catch (error) {
                    results.push({
                        name: test.name,
                        url: test.url,
                        error: error.message
                    });
                }
            }
            
            // Display results
            let resultHtml = '<h3>Test Results:</h3>';
            results.forEach(result => {
                if (result.error) {
                    resultHtml += `<p><strong>${result.name}:</strong> ‚ùå Error: ${result.error}</p>`;
                } else {
                    const icon = result.ok ? '‚úÖ' : '‚ùå';
                    const typeIcon = result.isJson ? 'üìÑ JSON' : 'üåê HTML';
                    resultHtml += `
                        <p><strong>${result.name}:</strong> ${icon} Status: ${result.status} | ${typeIcon} | ${result.elapsed}ms</p>
                        <small>URL: ${result.url}</small><br>
                    `;
                }
            });
            
            document.getElementById('debugInfo').innerHTML = resultHtml;
            document.getElementById('debugInfo').classList.remove('hidden');
        }
        
        // Show message
        function showMessage(text, type = 'success') {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = text;
            msgDiv.className = `message ${type}`;
            msgDiv.style.display = 'block';
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 5000);
        }
        
        // Simulate login for testing
        function simulateLogin() {
            const testToken = 'test-token-12345';
            localStorage.setItem('adminToken', testToken);
            token = testToken;
            updateConfigDisplay();
            showMessage('Test token set. Try loading blogs now.', 'info');
            loadBlogs();
        }
        
        // Load blogs with better error handling
        async function loadBlogs() {
            try {
                const status = document.getElementById('statusFilter').value;
                const category = document.getElementById('categoryFilter').value;
                
                // Try different endpoint patterns
                let endpoints = [
                    `${ADMIN_API_BASE}/blogs`,
                    `${ADMIN_API_BASE}`,
                    `${API_BASE}/admin/blogs`,
                    `${API_BASE}/admin`
                ];
                
                // Add query parameters
                endpoints = endpoints.map(ep => {
                    let url = `${ep}?page=${currentPage}`;
                    if (status !== 'all') url += `&status=${status}`;
                    if (category !== 'all') url += `&category=${category}`;
                    return url;
                });
                
                showMessage('Loading blogs...', 'info');
                
                // Try each endpoint until one works
                let data = null;
                let lastError = null;
                
                for (const url of endpoints) {
                    try {
                        console.log('Trying endpoint:', url);
                        
                        const headers = {
                            'Accept': 'application/json'
                        };
                        
                        if (token) {
                            headers['Authorization'] = `Bearer ${token}`;
                        }
                        
                        const response = await fetch(url, { headers });
                        
                        // Check if response is JSON
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            const text = await response.text();
                            console.warn('Non-JSON response from', url, ':', text.substring(0, 200));
                            throw new Error('Server returned HTML instead of JSON');
                        }
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            data = result;
                            console.log('Success with endpoint:', url);
                            // Update ADMIN_API_BASE to working endpoint
                            const baseUrl = url.split('?')[0];
                            ADMIN_API_BASE = baseUrl.replace('/blogs', '').replace('/admin', '');
                            updateConfigDisplay();
                            break;
                        } else {
                            lastError = result.message || 'Unknown error';
                        }
                    } catch (error) {
                        lastError = error.message;
                        console.log('Endpoint failed:', url, error.message);
                    }
                }
                
                if (data) {
                    displayBlogs(data);
                    showMessage(`Loaded ${data.data.length} blogs`, 'success');
                } else {
                    throw new Error(`All endpoints failed. Last error: ${lastError}`);
                }
                
            } catch (error) {
                console.error('Load blogs error:', error);
                
                // Show sample data for testing
                if (debugMode) {
                    showSampleData();
                    showMessage('Using sample data. Real API call failed: ' + error.message, 'error');
                } else {
                    showMessage('Error loading blogs: ' + error.message, 'error');
                }
            }
        }
        
        // Display sample data for testing
        function showSampleData() {
            const sampleBlogs = [
                {
                    _id: '1',
                    title: 'Sample Blog Post 1',
                    slug: 'sample-blog-1',
                    category: 'Technology',
                    status: 'published',
                    views: 150,
                    createdAt: new Date().toISOString(),
                    excerpt: 'This is a sample blog post for testing.'
                },
                {
                    _id: '2',
                    title: 'Sample Blog Post 2',
                    slug: 'sample-blog-2',
                    category: 'Fashion',
                    status: 'draft',
                    views: 45,
                    createdAt: new Date().toISOString(),
                    excerpt: 'Another sample blog post for testing.'
                }
            ];
            
            const tbody = document.getElementById('blogTableBody');
            tbody.innerHTML = '';
            
            sampleBlogs.forEach(blog => {
                const date = new Date(blog.createdAt).toLocaleDateString();
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${blog.title}</strong><br>
                        <small style="color: #666">${blog.slug}</small>
                    </td>
                    <td>${blog.category}</td>
                    <td>
                        <span class="status-badge status-${blog.status}">
                            ${blog.status}
                        </span>
                    </td>
                    <td>${blog.views}</td>
                    <td>${date}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editBlog('${blog._id}')" style="padding: 5px 10px; font-size: 12px;">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteBlog('${blog._id}')" style="padding: 5px 10px; font-size: 12px;">
                            üóëÔ∏è Delete
                        </button>
                        <small style="display: block; color: #666; margin-top: 5px;">Sample Data</small>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Display blogs in table
        function displayBlogs(data) {
            const tbody = document.getElementById('blogTableBody');
            
            if (!data.data || data.data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            No blogs found. Create your first blog!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            data.data.forEach(blog => {
                const date = new Date(blog.createdAt || blog.publishedAt || new Date()).toLocaleDateString();
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${blog.title}</strong><br>
                        <small style="color: #666">${blog.slug || 'no-slug'}</small>
                    </td>
                    <td>${blog.category}</td>
                    <td>
                        <span class="status-badge status-${blog.status || 'draft'}">
                            ${blog.status || 'draft'}
                        </span>
                    </td>
                    <td>${blog.views || 0}</td>
                    <td>${date}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editBlog('${blog._id}')" style="padding: 5px 10px; font-size: 12px;">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-warning" onclick="viewBlog('${blog._id}')" style="padding: 5px 10px; font-size: 12px;">
                            üëÅÔ∏è View
                        </button>
                        <button class="btn btn-danger" onclick="deleteBlog('${blog._id}')" style="padding: 5px 10px; font-size: 12px;">
                            üóëÔ∏è Delete
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Show create form
        function showCreateForm() {
            if (!token) {
                showMessage('Please login first!', 'error');
                return;
            }
            
            document.getElementById('modalTitle').textContent = 'Create New Blog';
            document.getElementById('blogForm').reset();
            document.getElementById('blogId').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('blogModal').style.display = 'flex';
        }
        
        // Edit blog
        async function editBlog(blogId) {
            try {
                // Try different endpoint patterns
                const endpoints = [
                    `${ADMIN_API_BASE}/blogs/${blogId}`,
                    `${ADMIN_API_BASE}/${blogId}`
                ];
                
                let blog = null;
                
                for (const url of endpoints) {
                    try {
                        const response = await fetch(url, {
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                blog = data.data;
                                break;
                            }
                        }
                    } catch (error) {
                        console.log('Endpoint failed:', url);
                    }
                }
                
                if (blog) {
                    document.getElementById('modalTitle').textContent = 'Edit Blog';
                    document.getElementById('blogId').value = blog._id;
                    document.getElementById('title').value = blog.title;
                    document.getElementById('excerpt').value = blog.excerpt;
                    document.getElementById('content').value = blog.content;
                    document.getElementById('featuredImage').value = blog.featuredImage;
                    document.getElementById('category').value = blog.category;
                    document.getElementById('tags').value = blog.tags?.join(', ') || '';
                    document.getElementById('readTime').value = blog.readTime || 5;
                    document.getElementById('sliderOrder').value = blog.sliderOrder || 0;
                    document.getElementById('featuredInSlider').checked = blog.featuredInSlider || false;
                    document.getElementById('status').value = blog.status || 'draft';
                    
                    // Show image preview
                    if (blog.featuredImage) {
                        const preview = document.getElementById('imagePreview');
                        preview.src = blog.featuredImage;
                        preview.style.display = 'block';
                    }
                    
                    document.getElementById('blogModal').style.display = 'flex';
                } else {
                    showMessage('Could not load blog for editing', 'error');
                }
            } catch (error) {
                showMessage('Error loading blog: ' + error.message, 'error');
            }
        }
        
        // View blog
        async function viewBlog(blogId) {
            try {
                const response = await fetch(`${API_BASE}/${blogId}`);
                const data = await response.json();
                
                if (data.success) {
                    const blog = data.data;
                    
                    // Create a simple preview modal
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.display = 'flex';
                    modal.innerHTML = `
                        <div class="modal-content">
                            <div class="modal-header">
                                <div class="modal-title">${blog.title}</div>
                                <button class="close-modal" onclick="this.parentElement.parentElement.parentElement.remove()">√ó</button>
                            </div>
                            <div style="padding: 20px;">
                                <img src="${blog.featuredImage}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">
                                <div style="color: #666; margin-bottom: 20px;">
                                    ${blog.category} ‚Ä¢ ${new Date(blog.createdAt).toLocaleDateString()} ‚Ä¢ ${blog.readTime || 5} min read
                                </div>
                                <div>${blog.content}</div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                }
            } catch (error) {
                // If API fails, show form data
                alert('Could not view blog. Please edit to see details.');
            }
        }
        
        // Delete blog
        async function deleteBlog(blogId) {
            if (!confirm('Are you sure you want to delete this blog?')) return;
            
            try {
                // Try different endpoint patterns
                const endpoints = [
                    `${ADMIN_API_BASE}/blogs/${blogId}`,
                    `${ADMIN_API_BASE}/${blogId}`
                ];
                
                let success = false;
                
                for (const url of endpoints) {
                    try {
                        const response = await fetch(url, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                success = true;
                                break;
                            }
                        }
                    } catch (error) {
                        console.log('Delete endpoint failed:', url);
                    }
                }
                
                if (success) {
                    showMessage('Blog deleted successfully');
                    loadBlogs();
                } else {
                    showMessage('Could not delete blog', 'error');
                }
            } catch (error) {
                showMessage('Error deleting blog: ' + error.message, 'error');
            }
        }
        
        // Save blog
        async function saveBlog(event) {
            event.preventDefault();
            
            const blogId = document.getElementById('blogId').value;
            const isEdit = !!blogId;
            
            // Prepare data
            const blogData = {
                title: document.getElementById('title').value,
                excerpt: document.getElementById('excerpt').value,
                content: document.getElementById('content').value,
                featuredImage: document.getElementById('featuredImage').value,
                category: document.getElementById('category').value,
                tags: document.getElementById('tags').value,
                readTime: parseInt(document.getElementById('readTime').value) || 5,
                sliderOrder: parseInt(document.getElementById('sliderOrder').value) || 0,
                featuredInSlider: document.getElementById('featuredInSlider').checked,
                status: document.getElementById('status').value,
                isPublished: document.getElementById('status').value === 'published'
            };
            
            // Try different endpoints
            let endpoints = [];
            if (isEdit) {
                endpoints = [
                    `${ADMIN_API_BASE}/blogs/${blogId}`,
                    `${ADMIN_API_BASE}/${blogId}`
                ];
            } else {
                endpoints = [
                    `${ADMIN_API_BASE}/blogs`,
                    `${ADMIN_API_BASE}`
                ];
            }
            
            try {
                let success = false;
                
                for (const url of endpoints) {
                    try {
                        const response = await fetch(url, {
                            method: isEdit ? 'PUT' : 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify(blogData)
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                success = true;
                                showMessage(isEdit ? 'Blog updated successfully' : 'Blog created successfully');
                                closeModal();
                                loadBlogs();
                                break;
                            }
                        }
                    } catch (error) {
                        console.log('Save endpoint failed:', url);
                    }
                }
                
                if (!success) {
                    showMessage('Could not save blog. Check console for details.', 'error');
                    // Show data for debugging
                    console.log('Attempted to save:', blogData);
                    console.log('Tried endpoints:', endpoints);
                }
                
            } catch (error) {
                showMessage('Error saving blog: ' + error.message, 'error');
            }
        }
        
        // Save as draft
        function saveAsDraft() {
            document.getElementById('status').value = 'draft';
            document.getElementById('blogForm').requestSubmit();
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('blogModal').style.display = 'none';
        }
        
        // Show stats
        function showStats() {
            alert('Stats feature would be implemented with a real API.');
        }
        
        // Preview image when URL changes
        document.getElementById('featuredImage').addEventListener('input', function(e) {
            const url = e.target.value;
            const preview = document.getElementById('imagePreview');
            
            if (url && (url.startsWith('http') || url.startsWith('data:'))) {
                preview.src = url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        });
        
        // Logout
        function logout() {
            localStorage.removeItem('adminToken');
            token = null;
            updateConfigDisplay();
            showMessage('Logged out successfully', 'info');
            location.reload();
        }
        
        // Add logout button to page
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('h1');
            const logoutBtn = document.createElement('button');
            logoutBtn.className = 'btn btn-danger';
            logoutBtn.textContent = 'Logout';
            logoutBtn.style.float = 'right';
            logoutBtn.onclick = logout;
            header.parentNode.insertBefore(logoutBtn, header.nextSibling);
        });
    </script>
</body>
</html>