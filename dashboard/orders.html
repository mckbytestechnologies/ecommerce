<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--secondary-color);
        }
        
        .sidebar {
            background-color: var(--dark-color);
            min-height: calc(100vh - 56px);
            color: white;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1rem;
            border-radius: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 0.5rem;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        
        .status-badge {
            padding: 0.35em 0.65em;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .order-item {
            border-bottom: 1px solid #eee;
            padding: 0.75rem 0;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .stats-card {
            text-align: center;
            padding: 1.5rem;
        }
        
        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stats-label {
            font-size: 0.875rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .action-btn {
            margin-right: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        .table th {
            border-top: none;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .order-details-section {
            background-color: white;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .order-details-section h5 {
            color: var(--secondary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .order-timeline {
            position: relative;
            padding-left: 2rem;
        }
        
        .order-timeline::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e9ecef;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.75rem;
            top: 0.25rem;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: var(--primary-color);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .timeline-item.completed::before {
            background-color: var(--success-color);
            box-shadow: 0 0 0 2px var(--success-color);
        }
        
        .timeline-item.current::before {
            background-color: white;
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .timeline-date {
            font-size: 0.75rem;
            color: #6c757d;
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.375rem;
        }
        
        .form-section {
            background-color: white;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shopping-bag me-2"></i>
                Order Management System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> John Doe
                        </a>
                        <ul class="dropdown-menu">
                            <li class="nav-item">
                                    <a class="nav-link" href="index.html">
                                        <i class="fas fa-tachometer-alt"></i>
                                        Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active" href="users.html">
                                        <i class="fas fa-users"></i>
                                        Users
                                    </a>
                                </li>
                                <li class="nav-item"><a href="categories.html" class="nav-link text-white">ðŸ“‘ Categories</a></li>

                                <li class="nav-item"><a href="products.html" class="nav-link text-white">ðŸ“¦ Products</a></li>

                                <li class="nav-item">
                                    <a class="nav-link" href="orders.html">
                                        <i class="fas fa-shopping-cart"></i>
                                        Orders
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="payment.html">
                                        <i class="fas fa-credit-card"></i>
                                        Payments
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <i class="fas fa-chart-bar"></i>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <i class="fas fa-cog"></i>
                                        Settings
                                    </a>
                                </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 col-md-3 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i> John Doe
                        </a>
                        <ul class="dropdown-menu">
                            <li class="nav-item">
                                    <a class="nav-link" href="index.html">
                                        <i class="fas fa-tachometer-alt"></i>
                                        Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link active" href="users.html">
                                        <i class="fas fa-users"></i>
                                        Users
                                    </a>
                                </li>
                                <li class="nav-item"><a href="categories.html" class="nav-link text-white">ðŸ“‘ Categories</a></li>

                                <li class="nav-item"><a href="products.html" class="nav-link text-white">ðŸ“¦ Products</a></li>

                                <li class="nav-item">
                                    <a class="nav-link" href="orders.html">
                                        <i class="fas fa-shopping-cart"></i>
                                        Orders
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="payment.html">
                                        <i class="fas fa-credit-card"></i>
                                        Payments
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <i class="fas fa-chart-bar"></i>
                                        Analytics
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">
                                        <i class="fas fa-cog"></i>
                                        Settings
                                    </a>
                                </li>
                        </ul>
                    </li>
                </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-lg-10 col-md-9 ms-sm-auto px-md-4 py-4">
                <!-- Page Header -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Order Management</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createOrderModal">
                            <i class="fas fa-plus me-1"></i> Create New Order
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="card stats-card">
                            <div class="stats-value text-primary">156</div>
                            <div class="stats-label">Total Orders</div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card stats-card">
                            <div class="stats-value text-warning">24</div>
                            <div class="stats-label">Pending Orders</div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card stats-card">
                            <div class="stats-value text-success">128</div>
                            <div class="stats-label">Completed Orders</div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card stats-card">
                            <div class="stats-value text-danger">4</div>
                            <div class="stats-label">Cancelled Orders</div>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Orders</h5>
                        <div class="d-flex">
                            <input type="text" class="form-control form-control-sm me-2" placeholder="Search orders...">
                            <select class="form-select form-select-sm" style="width: auto;">
                                <option>All Status</option>
                                <option>Pending</option>
                                <option>Confirmed</option>
                                <option>Processing</option>
                                <option>Shipped</option>
                                <option>Delivered</option>
                                <option>Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Payment</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Orders will be populated here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Order pagination">
                            <ul class="pagination justify-content-end">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Create Order Modal -->
    <div class="modal fade" id="createOrderModal" tabindex="-1" aria-labelledby="createOrderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createOrderModalLabel">Create New Order</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createOrderForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="user" class="form-label">Customer</label>
                                <select class="form-select" id="user" required>
                                    <option value="">Select Customer</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="paymentMethod" class="form-label">Payment Method</label>
                                <select class="form-select" id="paymentMethod" required>
                                    <option value="">Select Payment Method</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="upi">UPI</option>
                                    <option value="netbanking">Net Banking</option>
                                    <option value="cod">Cash on Delivery</option>
                                    <option value="wallet">Wallet</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="shippingAddress" class="form-label">Shipping Address</label>
                                <select class="form-select" id="shippingAddress" required>
                                    <option value="">Select Shipping Address</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="billingAddress" class="form-label">Billing Address</label>
                                <select class="form-select" id="billingAddress">
                                    <option value="">Same as Shipping Address</option>
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Order Items</label>
                            <div id="orderItemsContainer">
                                <div class="order-item row mb-2">
                                    <div class="col-md-5">
                                        <select class="form-select product-select" required>
                                            <option value="">Select Product</option>
                                            <!-- Options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <input type="number" class="form-control quantity-input" min="1" value="1" required>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="text" class="form-control price-input" readonly>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger btn-sm remove-item-btn">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addItemBtn">
                                <i class="fas fa-plus me-1"></i> Add Item
                            </button>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="subtotal" class="form-label">Subtotal</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="subtotal" readonly>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="shippingCharge" class="form-label">Shipping Charge</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="shippingCharge" value="0" min="0" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="totalAmount" class="form-label">Total Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="totalAmount" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="notes" class="form-label">Order Notes</label>
                            <textarea class="form-control" id="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitOrderBtn">Create Order</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Order Modal -->
    <div class="modal fade" id="viewOrderModal" tabindex="-1" aria-labelledby="viewOrderModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewOrderModalLabel">Order Details - <span id="orderIdHeader"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Order Items -->
                            <div class="order-details-section">
                                <h5>Order Items</h5>
                                <div id="orderItemsDetails">
                                    <!-- Items will be populated by JavaScript -->
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-8"></div>
                                    <div class="col-md-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Subtotal:</span>
                                            <span id="detailSubtotal">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Shipping:</span>
                                            <span id="detailShipping">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Tax:</span>
                                            <span id="detailTax">$0.00</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Discount:</span>
                                            <span id="detailDiscount">$0.00</span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between fw-bold">
                                            <span>Total:</span>
                                            <span id="detailTotal">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Timeline -->
                            <div class="order-details-section">
                                <h5>Order Timeline</h5>
                                <div class="order-timeline" id="orderTimeline">
                                    <!-- Timeline items will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <!-- Order Summary -->
                            <div class="order-details-section">
                                <h5>Order Summary</h5>
                                <div class="mb-3">
                                    <strong>Order Status:</strong>
                                    <span class="badge status-badge bg-primary ms-2" id="detailOrderStatus">Pending</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Payment Status:</strong>
                                    <span class="badge status-badge bg-success ms-2" id="detailPaymentStatus">Completed</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Payment Method:</strong>
                                    <span id="detailPaymentMethod">Credit Card</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Order Date:</strong>
                                    <span id="detailOrderDate">Jan 1, 2023</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Expected Delivery:</strong>
                                    <span id="detailExpectedDelivery">Jan 5, 2023</span>
                                </div>
                            </div>
                            
                            <!-- Customer Information -->
                            <div class="order-details-section">
                                <h5>Customer Information</h5>
                                <div class="mb-3">
                                    <strong>Name:</strong>
                                    <span id="detailCustomerName">John Doe</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Email:</strong>
                                    <span id="detailCustomerEmail">john.doe@example.com</span>
                                </div>
                                <div class="mb-3">
                                    <strong>Phone:</strong>
                                    <span id="detailCustomerPhone">+1 (555) 123-4567</span>
                                </div>
                            </div>
                            
                            <!-- Shipping & Billing -->
                            <div class="order-details-section">
                                <h5>Shipping Address</h5>
                                <div id="detailShippingAddress">
                                    <!-- Address will be populated by JavaScript -->
                                </div>
                                
                                <h5 class="mt-3">Billing Address</h5>
                                <div id="detailBillingAddress">
                                    <!-- Address will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="cancelOrderBtn">Cancel Order</button>
                    <button type="button" class="btn btn-primary" id="updateStatusBtn">Update Status</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Status Modal -->
    <div class="modal fade" id="updateStatusModal" tabindex="-1" aria-labelledby="updateStatusModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateStatusModalLabel">Update Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateStatusForm">
                        <div class="mb-3">
                            <label for="orderStatus" class="form-label">Order Status</label>
                            <select class="form-select" id="orderStatus" required>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="processing">Processing</option>
                                <option value="shipped">Shipped</option>
                                <option value="delivered">Delivered</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="trackingNumber" class="form-label">Tracking Number</label>
                            <input type="text" class="form-control" id="trackingNumber">
                        </div>
                        <div class="mb-3">
                            <label for="shippingCarrier" class="form-label">Shipping Carrier</label>
                            <input type="text" class="form-control" id="shippingCarrier">
                        </div>
                        <div class="mb-3">
                            <label for="expectedDelivery" class="form-label">Expected Delivery</label>
                            <input type="date" class="form-control" id="expectedDelivery">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStatusBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data for demonstration
        const sampleData = {
            users: [
                { _id: 'user1', name: 'John Doe', email: 'john.doe@example.com', phone: '+1 (555) 123-4567' },
                { _id: 'user2', name: 'Jane Smith', email: 'jane.smith@example.com', phone: '+1 (555) 987-6543' },
                { _id: 'user3', name: 'Robert Johnson', email: 'robert.j@example.com', phone: '+1 (555) 456-7890' }
            ],
            addresses: [
                { _id: 'addr1', user: 'user1', type: 'shipping', street: '123 Main St', city: 'New York', state: 'NY', zipCode: '10001', country: 'USA' },
                { _id: 'addr2', user: 'user1', type: 'billing', street: '123 Main St', city: 'New York', state: 'NY', zipCode: '10001', country: 'USA' },
                { _id: 'addr3', user: 'user2', type: 'shipping', street: '456 Oak Ave', city: 'Los Angeles', state: 'CA', zipCode: '90001', country: 'USA' },
                { _id: 'addr4', user: 'user3', type: 'shipping', street: '789 Pine Rd', city: 'Chicago', state: 'IL', zipCode: '60007', country: 'USA' }
            ],
            products: [
                { _id: 'prod1', name: 'Wireless Headphones', price: 99.99, image: 'https://via.placeholder.com/60' },
                { _id: 'prod2', name: 'Smartphone', price: 699.99, image: 'https://via.placeholder.com/60' },
                { _id: 'prod3', name: 'Laptop', price: 1299.99, image: 'https://via.placeholder.com/60' },
                { _id: 'prod4', name: 'Smart Watch', price: 249.99, image: 'https://via.placeholder.com/60' },
                { _id: 'prod5', name: 'Tablet', price: 499.99, image: 'https://via.placeholder.com/60' }
            ],
            orders: [
                {
                    _id: 'order1',
                    order_id: 'ORD123456789',
                    user: 'user1',
                    items: [
                        { product: 'prod1', quantity: 1, price: 99.99, name: 'Wireless Headphones', image: 'https://via.placeholder.com/60' },
                        { product: 'prod4', quantity: 2, price: 249.99, name: 'Smart Watch', image: 'https://via.placeholder.com/60' }
                    ],
                    shipping_address: 'addr1',
                    billing_address: 'addr2',
                    payment_method: 'card',
                    payment_status: 'completed',
                    order_status: 'shipped',
                    subtotal: 599.97,
                    shipping_charge: 10.00,
                    tax_amount: 48.00,
                    discount_amount: 0.00,
                    total_amount: 657.97,
                    tracking_number: 'TRK123456789',
                    shipping_carrier: 'FedEx',
                    expected_delivery: '2023-06-15',
                    createdAt: '2023-06-10T10:30:00Z',
                    notes: 'Please deliver after 5 PM'
                },
                {
                    _id: 'order2',
                    order_id: 'ORD987654321',
                    user: 'user2',
                    items: [
                        { product: 'prod2', quantity: 1, price: 699.99, name: 'Smartphone', image: 'https://via.placeholder.com/60' }
                    ],
                    shipping_address: 'addr3',
                    billing_address: 'addr3',
                    payment_method: 'upi',
                    payment_status: 'completed',
                    order_status: 'delivered',
                    subtotal: 699.99,
                    shipping_charge: 0.00,
                    tax_amount: 56.00,
                    discount_amount: 50.00,
                    total_amount: 705.99,
                    tracking_number: 'TRK987654321',
                    shipping_carrier: 'UPS',
                    expected_delivery: '2023-06-12',
                    createdAt: '2023-06-08T14:45:00Z',
                    notes: ''
                },
                {
                    _id: 'order3',
                    order_id: 'ORD456123789',
                    user: 'user3',
                    items: [
                        { product: 'prod3', quantity: 1, price: 1299.99, name: 'Laptop', image: 'https://via.placeholder.com/60' },
                        { product: 'prod5', quantity: 1, price: 499.99, name: 'Tablet', image: 'https://via.placeholder.com/60' }
                    ],
                    shipping_address: 'addr4',
                    billing_address: 'addr4',
                    payment_method: 'netbanking',
                    payment_status: 'pending',
                    order_status: 'confirmed',
                    subtotal: 1799.98,
                    shipping_charge: 15.00,
                    tax_amount: 144.00,
                    discount_amount: 100.00,
                    total_amount: 1858.98,
                    tracking_number: '',
                    shipping_carrier: '',
                    expected_delivery: '2023-06-20',
                    createdAt: '2023-06-11T09:15:00Z',
                    notes: 'Gift wrapping requested'
                }
            ]
        };

        // DOM elements
        const ordersTableBody = document.getElementById('ordersTableBody');
        const createOrderForm = document.getElementById('createOrderForm');
        const orderItemsContainer = document.getElementById('orderItemsContainer');
        const addItemBtn = document.getElementById('addItemBtn');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        const userSelect = document.getElementById('user');
        const shippingAddressSelect = document.getElementById('shippingAddress');
        const billingAddressSelect = document.getElementById('billingAddress');
        const subtotalInput = document.getElementById('subtotal');
        const shippingChargeInput = document.getElementById('shippingCharge');
        const totalAmountInput = document.getElementById('totalAmount');
        const viewOrderModal = new bootstrap.Modal(document.getElementById('viewOrderModal'));
        const updateStatusModal = new bootstrap.Modal(document.getElementById('updateStatusModal'));
        const saveStatusBtn = document.getElementById('saveStatusBtn');
        const cancelOrderBtn = document.getElementById('cancelOrderBtn');
        const updateStatusBtn = document.getElementById('updateStatusBtn');

        // Current order being viewed
        let currentOrder = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            populateUserDropdown();
            populateProductDropdowns();
            displayOrders();
            
            // Event listeners
            addItemBtn.addEventListener('click', addOrderItem);
            submitOrderBtn.addEventListener('click', createOrder);
            shippingChargeInput.addEventListener('input', calculateTotal);
            userSelect.addEventListener('change', updateAddressDropdowns);
            saveStatusBtn.addEventListener('click', updateOrderStatus);
            cancelOrderBtn.addEventListener('click', cancelOrder);
            updateStatusBtn.addEventListener('click', showUpdateStatusModal);
        });

        // Populate user dropdown
        function populateUserDropdown() {
            userSelect.innerHTML = '<option value="">Select Customer</option>';
            sampleData.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user._id;
                option.textContent = `${user.name} (${user.email})`;
                userSelect.appendChild(option);
            });
        }

        // Populate product dropdowns
        function populateProductDropdowns() {
            const productSelects = document.querySelectorAll('.product-select');
            productSelects.forEach(select => {
                select.innerHTML = '<option value="">Select Product</option>';
                sampleData.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product._id;
                    option.textContent = `${product.name} - $${product.price}`;
                    option.dataset.price = product.price;
                    select.appendChild(option);
                });
                
                // Add event listener for price update
                select.addEventListener('change', function() {
                    const priceInput = this.closest('.order-item').querySelector('.price-input');
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.value) {
                        priceInput.value = selectedOption.dataset.price;
                    } else {
                        priceInput.value = '';
                    }
                    calculateSubtotal();
                });
            });
        }

        // Update address dropdowns based on selected user
        function updateAddressDropdowns() {
            const userId = userSelect.value;
            
            // Clear and populate shipping address dropdown
            shippingAddressSelect.innerHTML = '<option value="">Select Shipping Address</option>';
            sampleData.addresses
                .filter(addr => addr.user === userId)
                .forEach(addr => {
                    const option = document.createElement('option');
                    option.value = addr._id;
                    option.textContent = `${addr.street}, ${addr.city}, ${addr.state} ${addr.zipCode}`;
                    shippingAddressSelect.appendChild(option);
                });
            
            // Clear and populate billing address dropdown
            billingAddressSelect.innerHTML = '<option value="">Same as Shipping Address</option>';
            sampleData.addresses
                .filter(addr => addr.user === userId)
                .forEach(addr => {
                    const option = document.createElement('option');
                    option.value = addr._id;
                    option.textContent = `${addr.street}, ${addr.city}, ${addr.state} ${addr.zipCode}`;
                    billingAddressSelect.appendChild(option);
                });
        }

        // Add new order item row
        function addOrderItem() {
            const newItem = document.createElement('div');
            newItem.className = 'order-item row mb-2';
            newItem.innerHTML = `
                <div class="col-md-5">
                    <select class="form-select product-select" required>
                        <option value="">Select Product</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control quantity-input" min="1" value="1" required>
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control price-input" readonly>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm remove-item-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            orderItemsContainer.appendChild(newItem);
            populateProductDropdowns();
            
            // Add event listener for remove button
            newItem.querySelector('.remove-item-btn').addEventListener('click', function() {
                newItem.remove();
                calculateSubtotal();
            });
            
            // Add event listener for quantity change
            newItem.querySelector('.quantity-input').addEventListener('input', calculateSubtotal);
        }

        // Calculate subtotal
        function calculateSubtotal() {
            let subtotal = 0;
            const items = document.querySelectorAll('.order-item');
            
            items.forEach(item => {
                const quantity = parseInt(item.querySelector('.quantity-input').value) || 0;
                const price = parseFloat(item.querySelector('.price-input').value) || 0;
                subtotal += quantity * price;
            });
            
            subtotalInput.value = subtotal.toFixed(2);
            calculateTotal();
        }

        // Calculate total amount
        function calculateTotal() {
            const subtotal = parseFloat(subtotalInput.value) || 0;
            const shipping = parseFloat(shippingChargeInput.value) || 0;
            const total = subtotal + shipping;
            totalAmountInput.value = total.toFixed(2);
        }

        // Create new order
        function createOrder() {
            // Validate form
            if (!createOrderForm.checkValidity()) {
                createOrderForm.reportValidity();
                return;
            }
            
            // Collect order data
            const orderData = {
                user: userSelect.value,
                items: [],
                shipping_address: shippingAddressSelect.value,
                billing_address: billingAddressSelect.value || shippingAddressSelect.value,
                payment_method: document.getElementById('paymentMethod').value,
                subtotal: parseFloat(subtotalInput.value),
                shipping_charge: parseFloat(shippingChargeInput.value),
                total_amount: parseFloat(totalAmountInput.value),
                notes: document.getElementById('notes').value
            };
            
            // Collect items
            document.querySelectorAll('.order-item').forEach(item => {
                const productSelect = item.querySelector('.product-select');
                const quantity = item.querySelector('.quantity-input').value;
                const price = item.querySelector('.price-input').value;
                
                if (productSelect.value) {
                    orderData.items.push({
                        product: productSelect.value,
                        quantity: parseInt(quantity),
                        price: parseFloat(price)
                    });
                }
            });
            
            // In a real application, you would send this data to the backend
            console.log('Creating order:', orderData);
            
            // Simulate API call
            setTimeout(() => {
                alert('Order created successfully!');
                bootstrap.Modal.getInstance(document.getElementById('createOrderModal')).hide();
                createOrderForm.reset();
                orderItemsContainer.innerHTML = `
                    <div class="order-item row mb-2">
                        <div class="col-md-5">
                            <select class="form-select product-select" required>
                                <option value="">Select Product</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control quantity-input" min="1" value="1" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control price-input" readonly>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-danger btn-sm remove-item-btn">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                populateProductDropdowns();
                displayOrders();
            }, 1000);
        }

        // Display orders in the table
        function displayOrders() {
            ordersTableBody.innerHTML = '';
            
            sampleData.orders.forEach(order => {
                const user = sampleData.users.find(u => u._id === order.user);
                const shippingAddress = sampleData.addresses.find(a => a._id === order.shipping_address);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.order_id}</td>
                    <td>${user ? user.name : 'Unknown'}</td>
                    <td>${new Date(order.createdAt).toLocaleDateString()}</td>
                    <td>$${order.total_amount.toFixed(2)}</td>
                    <td>
                        <span class="badge status-badge ${getStatusBadgeClass(order.order_status)}">
                            ${order.order_status.charAt(0).toUpperCase() + order.order_status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <span class="badge status-badge ${getPaymentBadgeClass(order.payment_status)}">
                            ${order.payment_status.charAt(0).toUpperCase() + order.payment_status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary action-btn view-order-btn" data-id="${order._id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-warning action-btn update-status-btn" data-id="${order._id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger action-btn cancel-order-btn" data-id="${order._id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                
                ordersTableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-order-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    viewOrder(orderId);
                });
            });
            
            document.querySelectorAll('.update-status-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    showUpdateStatusModal(orderId);
                });
            });
            
            document.querySelectorAll('.cancel-order-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to cancel this order?')) {
                        cancelOrder(orderId);
                    }
                });
            });
        }

        // Get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'bg-secondary';
                case 'confirmed': return 'bg-info';
                case 'processing': return 'bg-primary';
                case 'shipped': return 'bg-warning';
                case 'delivered': return 'bg-success';
                case 'cancelled': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        // Get payment badge class
        function getPaymentBadgeClass(status) {
            switch(status) {
                case 'pending': return 'bg-warning';
                case 'processing': return 'bg-info';
                case 'completed': return 'bg-success';
                case 'failed': return 'bg-danger';
                case 'refunded': return 'bg-secondary';
                default: return 'bg-secondary';
            }
        }

        // View order details
        function viewOrder(orderId) {
            currentOrder = sampleData.orders.find(o => o._id === orderId);
            if (!currentOrder) return;
            
            const user = sampleData.users.find(u => u._id === currentOrder.user);
            const shippingAddress = sampleData.addresses.find(a => a._id === currentOrder.shipping_address);
            const billingAddress = sampleData.addresses.find(a => a._id === currentOrder.billing_address);
            
            // Update modal header
            document.getElementById('orderIdHeader').textContent = currentOrder.order_id;
            
            // Update order items
            const orderItemsDetails = document.getElementById('orderItemsDetails');
            orderItemsDetails.innerHTML = '';
            
            currentOrder.items.forEach(item => {
                const product = sampleData.products.find(p => p._id === item.product);
                const itemElement = document.createElement('div');
                itemElement.className = 'order-item row';
                itemElement.innerHTML = `
                    <div class="col-md-1">
                        <img src="${item.image || product.image}" alt="${item.name}" class="product-image">
                    </div>
                    <div class="col-md-5">
                        <div class="fw-bold">${item.name}</div>
                        <div class="text-muted small">SKU: ${item.product}</div>
                    </div>
                    <div class="col-md-2 text-center">${item.quantity}</div>
                    <div class="col-md-2 text-end">$${item.price.toFixed(2)}</div>
                    <div class="col-md-2 text-end fw-bold">$${(item.quantity * item.price).toFixed(2)}</div>
                `;
                orderItemsDetails.appendChild(itemElement);
            });
            
            // Update order totals
            document.getElementById('detailSubtotal').textContent = `$${currentOrder.subtotal.toFixed(2)}`;
            document.getElementById('detailShipping').textContent = `$${currentOrder.shipping_charge.toFixed(2)}`;
            document.getElementById('detailTax').textContent = `$${currentOrder.tax_amount.toFixed(2)}`;
            document.getElementById('detailDiscount').textContent = `-$${currentOrder.discount_amount.toFixed(2)}`;
            document.getElementById('detailTotal').textContent = `$${currentOrder.total_amount.toFixed(2)}`;
            
            // Update order summary
            document.getElementById('detailOrderStatus').textContent = 
                currentOrder.order_status.charAt(0).toUpperCase() + currentOrder.order_status.slice(1);
            document.getElementById('detailOrderStatus').className = 
                `badge status-badge ${getStatusBadgeClass(currentOrder.order_status)}`;
            
            document.getElementById('detailPaymentStatus').textContent = 
                currentOrder.payment_status.charAt(0).toUpperCase() + currentOrder.payment_status.slice(1);
            document.getElementById('detailPaymentStatus').className = 
                `badge status-badge ${getPaymentBadgeClass(currentOrder.payment_status)}`;
            
            document.getElementById('detailPaymentMethod').textContent = 
                currentOrder.payment_method.charAt(0).toUpperCase() + currentOrder.payment_method.slice(1);
            
            document.getElementById('detailOrderDate').textContent = 
                new Date(currentOrder.createdAt).toLocaleDateString();
            
            document.getElementById('detailExpectedDelivery').textContent = 
                currentOrder.expected_delivery ? new Date(currentOrder.expected_delivery).toLocaleDateString() : 'Not set';
            
            // Update customer information
            if (user) {
                document.getElementById('detailCustomerName').textContent = user.name;
                document.getElementById('detailCustomerEmail').textContent = user.email;
                document.getElementById('detailCustomerPhone').textContent = user.phone;
            }
            
            // Update addresses
            if (shippingAddress) {
                document.getElementById('detailShippingAddress').innerHTML = `
                    <div>${shippingAddress.street}</div>
                    <div>${shippingAddress.city}, ${shippingAddress.state} ${shippingAddress.zipCode}</div>
                    <div>${shippingAddress.country}</div>
                `;
            }
            
            if (billingAddress) {
                document.getElementById('detailBillingAddress').innerHTML = `
                    <div>${billingAddress.street}</div>
                    <div>${billingAddress.city}, ${billingAddress.state} ${billingAddress.zipCode}</div>
                    <div>${billingAddress.country}</div>
                `;
            }
            
            // Update order timeline
            updateOrderTimeline(currentOrder);
            
            // Show the modal
            viewOrderModal.show();
        }

        // Update order timeline
        function updateOrderTimeline(order) {
            const orderTimeline = document.getElementById('orderTimeline');
            orderTimeline.innerHTML = '';
            
            const statuses = [
                { status: 'pending', label: 'Order Placed', date: order.createdAt },
                { status: 'confirmed', label: 'Order Confirmed', date: order.order_status === 'confirmed' || 
                    order.order_status === 'processing' || order.order_status === 'shipped' || 
                    order.order_status === 'delivered' ? new Date(order.createdAt).toISOString() : null },
                { status: 'processing', label: 'Processing', date: order.order_status === 'processing' || 
                    order.order_status === 'shipped' || order.order_status === 'delivered' ? 
                    new Date(order.createdAt).toISOString() : null },
                { status: 'shipped', label: 'Shipped', date: order.tracking_number ? 
                    new Date(order.createdAt).toISOString() : null },
                { status: 'delivered', label: 'Delivered', date: order.order_status === 'delivered' ? 
                    new Date(order.createdAt).toISOString() : null }
            ];
            
            statuses.forEach((item, index) => {
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                
                if (item.date) {
                    timelineItem.classList.add('completed');
                }
                
                if (order.order_status === item.status) {
                    timelineItem.classList.add('current');
                }
                
                timelineItem.innerHTML = `
                    <div class="fw-bold">${item.label}</div>
                    <div class="timeline-date">${item.date ? new Date(item.date).toLocaleDateString() : 'Pending'}</div>
                `;
                
                orderTimeline.appendChild(timelineItem);
            });
        }

        // Show update status modal
        function showUpdateStatusModal(orderId = null) {
            if (orderId) {
                currentOrder = sampleData.orders.find(o => o._id === orderId);
            }
            
            if (!currentOrder) return;
            
            // Pre-fill form with current values
            document.getElementById('orderStatus').value = currentOrder.order_status;
            document.getElementById('trackingNumber').value = currentOrder.tracking_number || '';
            document.getElementById('shippingCarrier').value = currentOrder.shipping_carrier || '';
            document.getElementById('expectedDelivery').value = currentOrder.expected_delivery || '';
            
            updateStatusModal.show();
        }

        // Update order status
        function updateOrderStatus() {
            if (!currentOrder) return;
            
            const newStatus = document.getElementById('orderStatus').value;
            const trackingNumber = document.getElementById('trackingNumber').value;
            const shippingCarrier = document.getElementById('shippingCarrier').value;
            const expectedDelivery = document.getElementById('expectedDelivery').value;
            
            // In a real application, you would send this data to the backend
            console.log('Updating order status:', {
                orderId: currentOrder._id,
                order_status: newStatus,
                tracking_number: trackingNumber,
                shipping_carrier: shippingCarrier,
                expected_delivery: expectedDelivery
            });
            
            // Simulate API call
            setTimeout(() => {
                // Update the order in our sample data
                currentOrder.order_status = newStatus;
                currentOrder.tracking_number = trackingNumber;
                currentOrder.shipping_carrier = shippingCarrier;
                currentOrder.expected_delivery = expectedDelivery;
                
                alert('Order status updated successfully!');
                updateStatusModal.hide();
                viewOrderModal.hide();
                displayOrders();
            }, 1000);
        }

        // Cancel order
        function cancelOrder(orderId = null) {
            if (orderId) {
                currentOrder = sampleData.orders.find(o => o._id === orderId);
            }
            
            if (!currentOrder) return;
            
            // In a real application, you would send this request to the backend
            console.log('Cancelling order:', currentOrder._id);
            
            // Simulate API call
            setTimeout(() => {
                // Update the order in our sample data
                currentOrder.order_status = 'cancelled';
                
                alert('Order cancelled successfully!');
                if (viewOrderModal._isShown) {
                    viewOrderModal.hide();
                }
                displayOrders();
            }, 1000);
        }
    </script>
</body>
</html>